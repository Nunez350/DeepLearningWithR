{
    "collab_server" : "",
    "contents" : "rm(list=ls(all=TRUE))\nlibrary(ape)\nlibrary(phylobase)\nlibrary(phylotools)\nsetwd(\"/Users/roynunez/patric_3_pipeline/borrelia_rickettsia\")\ntr<-read.tree(\"bore-rick.dnd4\")\ntr.unrooted <- unroot(tr)\nph <-  read.table(\"borrelia-rickettsia-presence-absence.txt\", header = T , sep=\"\\t\", row.names = 1)#, row.names = 1)\nph.mat <- as.matrix(ph)\nph.t <- t(ph.mat)\nrownames(ph.t) <- gsub(\"X\", \"x\", rownames(ph.t))\nph.t[tr.unrooted$tip.label,1]\nclass(ph.t[tr$tip.label,1])\nph.t\nclass(ph.t[tr.unrooted$tip.label,1])\nace(ph.t[tr.unrooted$tip.label,1],tr,type= \"d\")\nstrep.ace<-ace(ph.t[tr.unrooted$tip.label,1],tr,type= \"d\")\nclass(tr)\nstrep.ace\ncolnames(ph.t)[column]\n\nco <- c(\"blue\", \"yellow\")\nplot.mpr <- function(column=1) {\n  plot.phylo(tr.unrooted, main = colnames(ph.t)[column])\n  tmpr<-MPR(ph.t[,column], tr.unrooted, outgroup = \"x412418.11\")\n  #nodelabels(paste(\"[\", tmpr[, 1], \",\", tmpr[, 2], \"]\", sep = \"\")) \n  tiplabels(ph.t[,column][tr.unrooted$tip.label], adj = -2)\n  return(tmpr)\n}\nph.t[,1]\n\n#  MPR(ph.t[,1], tr.unrooted, outgroup = \"x412418.11\")\nplot.mpr(1)\ntr.unrooted$node.label<- NULL\ntr.unrooted\ntmpr\ndatalist <- data.frame(fam=character(), a=numeric(), b=numeric(), c=numeric())\nfor (i in 1:ncol(ph.t)) {\n  tmpr<-MPR(ph.t[,i], tr.unrooted, outgroup = \"x412418.11\");\n  tmpr\n  out<-c(colnames(ph.t)[i],tmpr[,1])\n  datalist <- rbind(datalist, data.frame(fam=colnames(ph.t)[i],a=tmpr[1,1], b=tmpr[2,1], c=tmpr[3,1], d=tmpr[4,1],e=tmpr[5,1],f=tmpr[6,1],g=tmpr[7,1],h=tmpr[8,1],i=tmpr[9,1], j=tmpr[10,1],k=tmpr[11,1],l=tmpr[12,1],m=tmpr[13,1],n=tmpr[14,1],o=tmpr[15,1],p=tmpr[16,1],q=tmpr[17,1],r=tmpr[18,1],s=tmpr[19,1],t=tmpr[20,1],u=tmpr[21,1], v=tmpr[22,1]))\n}\ndatalist\ntmpr\n#for (j in lenth(alpha.pfam) {\n#  alpha.pfam <-paste(letters[1:22])\n#lapply rbind(datalist2, data.frame(fam=colnames(ph.t)[i], alpha.pfam[j]=tmpr[i+1]))\nout\nnrow(datalist)\ntr.unrooted$edge\ntmpr\n[,1]\n#output <- apply(tr.unrooted$edge, 1, function(x){parent<-x[1]; child<-x[2]; tip.state<-ph.t[,1]; names(tip.state)<-1:29; child.vecter <- c(tmpr[,1], tip.state); parent.state<-tmpr[which(names(tmpr[,1])==parent),1]; child.state<-child.vector[which(names(child.vector)==child)]; c(parent.id=parent, parent.state=parent.state, child.id=child, child.state=child.state)})\noutput <- apply(tr.unrooted$edge, 1, function(x){parent<-x[1]; child<-x[2]; tip.state<-ph.t[,1]; names(tip.state)<-1:29; child.vecter <- c(tmpr[,1], tip.state); parent.state<-tmpr[which(names(tmpr[,1])==parent),1]; child.state<-child.vecter[which(names(child.vecter)==child)]; c(parent.id=parent, parent.state=parent.state, child.id=child, child.state=child.state)})\n#output <- apply(tr.unrooted$edge, 1, function(x){parent<-x[1]; child<-x[2]; tip.state<-ph.t[,1]; names(tip.state)<-1:29; child.vecter <- c(tmpr[,1], tip.state); parent.state<-tmpr[which(names(tmpr[,1])==parent),1]; child.state<-child.vecter[which(names(child.vecter)==child)]; rbind(output, data.frame(parent.id=parent, parent.state=parent.state, child.id=child, child.state=child.state))})\noutput\n\ndataframe2t<-head(t(as.data.frame(output, row.names = c(\"p\", \"p.state\", \"c\", \"c.state\"), col.names=paste(\"br\", 1:55, sep=\"\"))), n=55)\ndf2<-cbind(dataframe2t,dataframe2t[,4] - dataframe2t[,2])\ndf2\ncolnames(df2)[5]<-\"gain.loss\"\nhead(df2)\nnrow(df2)\ndf2\ngains<-which(df2[,5]>0)\n\nlosses<-which(df2[,5]<0)\ntr.unrooted$edge.length\n\nplot(tr,use.edge.length = F)\n\ngains\nlosses\nedgelabels(gains, adj = c(0.5,-0.25), col=4, frame= \"none\")\nedgelabels(losses, adj = c(0.5,1.25), col=4, frame= \"none\")\nedgelabels(gains, col=2, frame= \"none\")\nnameid<-read.table(\"tree-sorted-genome-id-name.txt\", sep=\"\\t\")\n\nnameid\ngsub(\"^(..........).+$\", \"\\\\1\", paste(\"\", namemid[,2], sep=\"\"), perl = T)\nnameid[,2]\ntr$tip.label<-as.character(nameid[,2])\ntr$tip.label\nrownames(namemid) <- gsub(\"^(..........).+$\", \"\\\\1\", paste(\"g_\", namemid[,1], sep=\"\"), perl = T)\nrownames(namemid) <- gsub(\"^(..........).+$\", \"\\\\1\", paste(\"g_\", namemid[,1], sep=\"\"), perl = T)\nplot(str)\n",
    "created" : 1499983921578.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "4190708455",
    "id" : "EB217D8D",
    "lastKnownWriteTime" : 6066188611752034310,
    "last_content_update" : 1500039504462,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled3"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}